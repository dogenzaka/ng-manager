"use strict";angular.module("ngManager",["ngRoute","ngAnimate","ngAria","ngMaterial","pascalprecht.translate","datePicker","ngCookies","naif.base64","ngTagsInput"]).config(["$routeProvider","$mdThemingProvider","$sceDelegateProvider",function(e,t,n){console.info("Configuring theme"),t.theme("menu").primaryPalette("indigo").accentPalette("orange"),t.theme("endpoint").primaryPalette("indigo").accentPalette("orange"),t.theme("entity").primaryPalette("indigo").accentPalette("orange"),t.theme("login").primaryPalette("indigo").accentPalette("orange"),t.theme("side").primaryPalette("teal").accentPalette("orange"),t.theme("dialog").primaryPalette("indigo").accentPalette("orange"),t.theme("previewDialog").primaryPalette("teal").accentPalette("orange"),console.info("Configuring routings"),e.when("/endpoints",{controller:"EndpointCtrl",templateUrl:"endpoint.html"}).when("/top",{controller:"TopCtrl",templateUrl:"top.html"}).when("/entity/:kind",{controller:"EntityCtrl",templateUrl:"entity/index.html"}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html"}),n.resourceUrlWhitelist(["self","**"])}]).run(["$rootScope","$endpointService","$apiService","$errorService","$location","$authService",function(e,t,n,r,i,o){console.info("Started running ng-manager");var a=t.getSelected();if(a){var l=i.search().token;l&&(o.saveToken(l,a),i.url("/top")),e.login=o.checkLogin(a),n.setup().then(function(){},function(e){r.showError(e)})}else i.url("/endpoints")}]),angular.module("ngManager").factory("$apiService",["$q","$endpointService","$http","$rootScope",function(e,t,n,r){var i=null,o=function(e){var n=t.getSelected(),r=n.url.replace(/(.*)\/+$/,"$1");return e=e.replace(/^\/+(.*)$/,"$1"),r+"/"+e},a=function(e){return function(t){return e(t.data)}},l=function(e){return function(t){var n=t.data&&t.data.message||t.statusText,r=new Error(n);r.status=status,e(r)}},c=function(t,r){return e(function(e,i){n({url:o(t),method:"GET",params:r}).then(a(e),l(i))})},u=function(t,r){return e(function(e,i){n({url:o(t),method:"POST",data:r}).then(a(e),l(i))})},s=function(t,r){return e(function(e,i){n({url:o(t),method:"PUT",data:r}).then(a(e),l(i))})},d=function(t,r){return e(function(e,i){n({url:o(t),method:"DELETE",params:r}).then(a(e),l(i))})},f=function(t,r){return e(function(e,i){n({url:o(t),method:"GET",params:r}).then(a(e),l(i))})},m=function(){return e(function(e,t){null!==i?e(i):(console.info("Getting config"),c("/config").then(e,t))})};return{setup:function(){return console.log("apiService.setup"),i=null,m().then(function(e){return i=e,console.log(i),r.$emit("config",i),i},function(e){return e})},getConfig:function(){return i},get:c,post:u,put:s,del:d,search:f}}]).factory("progressHttpInterceptor",["$rootScope","$q",function(e,t){var n=0,r=function(){0===n++&&e.$emit("progress.start")},i=function(){0===--n&&(n=0,e.$emit("progress.end"))};return{request:function(e){return r(),e||t.when(e)},requestError:function(e){return i(),t.reject(e)},response:function(e){return i(),e||t.when(e)},responseError:function(e){return i(),t.reject(e)}}}]).factory("authHttpInterceptor",["$q","$rootScope","$location","$endpointService","$cookies",function(e,t,n,r,i){return{request:function(t){var n=r.getSelected();if(!n)return t||e.when(t);var o=[],a=localStorage.getItem("tokens");a&&(o=JSON.parse(a));var l=_.find(o,{name:n.name}),c="X-XSRF-TOKEN";return l&&(t.headers[c]=l.token),i["XSRF-TOKEN"]&&delete i["XSRF-TOKEN"],t||e.when(t)},responseError:function(t){var r=t.status;return console.log(r),401===r&&n.path("/login"),e.reject(t)}}}]).config(["$httpProvider",function(e){e.interceptors.push("progressHttpInterceptor"),e.interceptors.push("authHttpInterceptor")}]),angular.module("ngManager").factory("$authService",["$q","$location","$rootScope","$endpointService","$apiService",function(e,t,n,r,i){var o=[],a=localStorage.getItem("tokens");a&&(o=JSON.parse(a));var l=function(){var e=r.getSelected();e&&i.get("/logout").then(function(){o=_.filter(o,function(t){return t.name!==e.name}),localStorage.setItem("tokens",JSON.stringify(o)),n.login=u(e)})},c=function(e,t){var n=_.findWhere(o,{name:t.name});n?o[o.indexOf(n)].token=e:o.push({name:t.name,token:e});var r=_.map(o,function(e){return _.pick(e,"name","token")});localStorage.setItem("tokens",JSON.stringify(r))},u=function(e){var t=_.find(o,function(t){return t.name===e.name});return t};return{logout:l,saveToken:c,checkLogin:u}}]),angular.module("ngManager").controller("EndpointCtrl",["$q","$scope","$rootScope","$schemaForm","$endpointService","$apiService","$errorService","$filter",function(e,t,n,r,i,o,a,l){t.endpoints=i.getAll(),t.remove=function(e){i.remove(e)},t.select=function(e){i.select(e),o.setup().then(function(){location.hash="top"},function(e){a.showError(e)})};var c=function(e){i.add(e)};n.$emit("content.title",{section:"Settings",page:"Endpoints"}),t.showForm=function(t){r.showDialog({title:"Add the endpoint",event:t,schema:{type:"object",properties:{name:{type:"string",maxLength:100,minLength:1},url:{type:"string",maxLength:100,minLength:1,format:"uri",style:"long"}},required:["name","url"]},submit:function(t){var n=e.defer(),r=t.entity;return c(r),n.resolve(),n.promise}})}}]),angular.module("ngManager").factory("$endpointService",function(){var e=[],t=localStorage.getItem("endpoints");return t&&(e=JSON.parse(t)),{getAll:function(){return e},getSelected:function(){return _.find(e,function(e){return e.selected===!0})},get:function(t){return e[t]},add:function(t){e.push(t),this.save()},remove:function(t){e.splice(t,1),this.save()},select:function(t){_.each(e,function(e,n){n===t?e.selected=!0:delete e.selected}),this.save()},save:function(){var t=_.map(e,function(e){return _.pick(e,"name","url","selected")});localStorage.setItem("endpoints",JSON.stringify(t))}}}),angular.module("ngManager").controller("EntityCtrl",["$q","$scope","$routeParams","$rootScope","$schemaForm","$entityService","$errorService","$schemaNormalizer","$window","sharedScopes",function(e,t,n,r,i,o,a,l,c,u){var s,d,f=n.kind,m=30,g=1,p=!1,h=!1;console.info("Entity",f),r.$emit("content.title",{section:"Entities",page:f}),t.kind=f,t.filter_q={};var v=function(e){var t=e.features,n=e.schema,r=t.list&&t.list.fields||_.keys(n.properties);return r.map(function(e){return"string"==typeof e&&(e={id:e,label:e}),e.label=e.label||e.id,e.label.indexOf(".")>=0?e.label=e.id.substr(e.label.indexOf(".")+1):e.label=e.id,e})},y=function(e){var t=e.features.search&&e.features.search.schema||{};return l(t)},$=function(e){if(d=e,u.getScope("TagCtrl")){var n=u.getScope("TagCtrl").entity;_.each(t.searchSchema.properties,function(e,t){"array"===e.type&&"tag"===e.format&&(d[t]=n[t])})}return d};t.list=function(){s=!0,o.list({kind:f}).then(function(e){var n=o.getConfig(f),r=v(n),i=y(n);t.fields=r,t.schema=n.schema,t.rows=e.list,t.searchSchema=i,g=e.list.length,t.edit=function(e,t){e.editing=t},t.blur=function(e){delete e.editing},setTimeout(k,0),s=!1},function(e){a.showError(e)})},t.loadMore=function(){if(!s&&!h){var e=g;e%m==0&&(s=!0,Promise.resolve().then(function(){return p?o.search({kind:f,query:d,limit:m,offset:e}):o.list({kind:f,limit:m,offset:e})}).then(function(e){0!==e.list.length&&(g+=e.list.length,t.rows=t.rows.concat(e.list),s=!1)},function(e){a.showError(e),s=!1}))}},t["export"]=function(){var e;p&&(e=$(t.searchForm)),o["export"](f,t.rows,e)},t["import"]=function(){o["import"](f)},t.search=function(){d=$(t.searchForm),o.search({kind:f,query:d,offset:0}).then(function(e){t.rows=e.list,g=e.list.length,p=!0},function(e){a.showError(e)})},t.toggleSearchform=function(){t.searchForm||(t.searchForm={}),t.toggled?t.toggled=!t.toggled:t.toggled=!0},t.filter=function(){o.filter({kind:f,query:t.filter_q}).then(function(e){t.rows=e.list,h=!0},function(e){a.showError(e)})};var k=function(){var e=document.getElementById("entity-table-body"),t=e.getBoundingClientRect(),n=Math.floor(c.innerHeight-t.top);e.style.height=n+"px"};t.$on("window.resize",k),t.list()}]),angular.module("ngManager").directive("entityTable",["$entityService","$errorService",function(e,t){return{restrict:"AE",link:function(n){var r=n.kind;n.add=function(){Promise.resolve().then(function(){return n.schema.addInitialize?e.get({kind:r,initialize:!0}):void 0}).then(function(t){e.showForm({kind:r,entity:t})},function(e){t.showError(e)})},n.$on("entity.removed",function(e,t){var r=n.rows;r.splice(r.indexOf(t.row),1)})},templateUrl:"entity/table.html"}}]).directive("headCell",function(){return{restrict:"AE",scope:!1,replace:!0,link:function(e){e.opening="",e.open=function(){e.opening="is_open"},e.close=function(){e.opening=""},e.blur=function(){e.opening=""}},templateUrl:"entity/head-cell.html"}}).directive("entityRow",["$entityService","$errorService","$document","$rootScope",function(e,t,n,r){return{restrict:"AE",scope:{row:"=",fields:"=",kind:"="},replace:!0,link:function(i){var o=i.kind,a=i.row;i.key=e.getKey({kind:o,entity:a}),i.edit=function(){e.get({kind:o,key:i.key}).then(function(t){e.showForm({kind:o,key:i.key,entity:t}).then(function(){i.row=t})},function(e){t.showError(e)})},i.remove=function(){if(i.removing){var n=e.getKey({kind:o,entity:a});e.remove({kind:o,key:n}).then(function(){r.$broadcast("entity.removed",{kind:o,key:n,row:a})},function(e){t.showError(e)})}else i.removing=!0},i.cancelRemoving=function(){delete i.removing},i.$on("$destroy",function(){n.off("click",i.cancelRemoving)})},templateUrl:"entity/row.html"}}]).directive("entityCell",["$entityService","$mdDialog",function(e,t){return{restrict:"AE",scope:{field:"=",key:"=",row:"=",kind:"="},replace:!0,link:function(n,r){var i=n.kind,o=n.row,a=n.field,l=n.key;n.edit=function(){n.editing=!0,setTimeout(function(){var t=function(){if(n.saving=!0,n.error=!1,"string"==typeof u)o[a.id]=c[0].value;else try{o[a.id]=JSON.parse(c[0].value)}catch(t){return console.log("ERROR. JSON.parse failed"),n.error=t,void(n.saving=!1)}e.saveField({kind:i,key:l,field:a.id,value:o[a.id]}).then(function(){n.saving=!1},function(e){n.saving=!1,n.error=e}),n.$digest()},c=r.find("input");c.focus();var u=o[a.id];c.bind("keyup",function(e){switch(e.keyCode){case 27:o[a.id]=u,n.$digest(),c.blur();break;case 13:t(),c.blur()}}),c.bind("blur",function(){u!==o[a.id]})},0)},a.preview&&(n.openOpt=function(){t.show({template:'<md-dialog md-theme="previewDialog" aria-label="Preview dialog"><preview-dialog /></md-dialog>',targetEvent:event,controller:["$scope",function(e){e.field=a,e.row=o,e.kind=i}]})}),n.blur=function(){n.editing=!1}},templateUrl:"entity/cell.html"}}]).directive("ngScroll",function(){return function(e,t,n){var r=t[0];t.bind("scroll",function(){r.scrollTop+r.offsetHeight>=.8*r.scrollHeight&&e.$apply(n.ngScroll)})}}).directive("previewDialog",function(){return{restrict:"AE",templateUrl:"entity/preview-dialog.html"}}).directive("previewItem",["$compile",function(e){return{restrict:"AE",link:function(t,n){var r=t.field,i=t.row,o="",a=r.preview.url.replace(/\{.+?\}/,i[r.id]);switch(r.preview.type){case"image":o='<img src="'+a+'" />';break;case"video":o='<video controls autoplay><source src="'+a+'"></video>'}var l=e(angular.element(o))(t);n.append(l)}}}]),angular.module("ngManager").filter("viewfilter",["$filter",function(e){return function(t,n,r){switch("object"==typeof t&&(t=JSON.stringify(t)),n){case"date":return r=r||"medium",e("date")(t,r);default:return t}}}]),angular.module("ngManager").service("$entityService",["$q","$apiService","$schemaForm","$filter",function(e,t,n,r){var i=function(e){return _.find(t.getConfig().entities,function(t){return t.id===e})},o=function(e){var t=e.features||{},n=t.list&&t.list.fields||_.keys(e.schema.properties);return _.map(n,function(e){return"string"==typeof e?{id:e}:e})};return{getConfig:i,list:function(n){n=n||{};var r=e.defer(),a=n.kind||"",l=n.limit||30,c=n.offset||0;return""===a?(r.reject(new Error("Kind is empty")),r.promise):(t.get("/entity/"+a,{limit:l,offset:c}).then(function(e){var t=i(a);void 0===t?r.reject({message:"Entity configuration not found for {{kind}}",params:{kind:a}}):(e.fields=o(t),r.resolve(e))},function(e){r.reject(e)}),r.promise)},get:function(n){return n=n||{},e(function(e,r){var o=n.kind||"";if(""===o)return r(new Error("kind is empty"));var a=n.key;return n.initialize&&(a=""),void 0===a?r(new Error("key is null")):void t.get("/entity/"+o+"/"+a).then(function(t){var n=i(o);void 0===n?r({message:"Entity configuration not found for {{kind}}",params:{kind:o}}):e(t)},r)})},showForm:function(e){var r=e.kind,o=e.key,a=e.entity||{},l=i(r),c=this;for(var u in l.schema.properties)(l.schema.properties[u].onlyCreate||l.schema.properties[u].onlyUpdate)&&(l.schema.properties[u].display="none",(!o&&l.schema.properties[u].onlyCreate||o&&l.schema.properties[u].onlyUpdate)&&(l.schema.properties[u].display=""));var s=function(){o||(o=c.getKey({kind:r,entity:a}));var n=t.put("/entity/"+r+"/"+o,a);return o||n.then(function(){c.list(e)}),n};return n.showSide({schema:l.schema,entity:a,submit:s})},getKey:function(e){var t=e.kind,n=e.entity,r=i(t),o=r.schema.primaryKey,a=o.map(function(e){return encodeURIComponent(null==n[e]?"":n[e])}).join(",");return a},saveField:function(e){var n=e.kind,r=e.key,i=e.field,o=e.value;return t.put("/entity/"+n+"/"+r+"/"+i,{value:o})},remove:function(e){var n=e.kind,r=e.key;return t.del("/entity/"+n+"/"+r)},search:function(n){return e(function(e,r){var o=n.kind;if(""===o)return r(new Error("kind is empty"));var a=n.query||"";if(""===a)return r(new Error("query is null"));var l=n.offset||0,c=n.limit||30;t.get("/search/entity/"+o,{query:a,limit:c,offset:l}).then(function(t){var n=i(o);void 0===n?r({message:"Entity configuration not found for {{kind}}",params:{kind:o}}):e(t)},r)})},filter:function(n){return e(function(e,r){var o=n.kind;if(""===o)return r(new Error("kind is empty"));var a=n.query||"";return""===a?r(new Error("query is null")):void t.get("/filter/entity/"+o,{query:a,limit:-1,offset:0}).then(function(t){var n=i(o);void 0===n?r({message:"Entity configuration not found for {{kind}}",params:{kind:o}}):e(t)},r)})},"import":function(e){var n=this,r=document.getElementById("importfile").files[0],i=new FileReader,o=null;i.readAsText(r,"utf-8"),i.onload=function(r){try{o=JSON.parse(r.target.result)}catch(i){console.err(i)}if(null!==o)for(var a=0;a<o.length;a++){var l=n.getKey({kind:e,entity:o[a]});t.put("/entity/"+e+"/"+l,o[a])}}},"export":function(e,t,n){var i=this;Promise.resolve().then(function(){return n?i.search({kind:e,query:n,limit:-1}):i.list({kind:e,limit:-1})}).then(function(t){var n=t.list,i=e+"_"+r("date")(new Date,"yyyyMMddHHmm")+".json",o=JSON.stringify(n);window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(TEMPORARY,1048576,function(e){e.root.getFile(i,{create:!0,exclusive:!1},function(e){e.createWriter(function(t){var n=new Blob([o],{type:"text/plain"});t.write(n),t.onwriteend=function(t){console.info("writing success");var n=document.createElement("a");n.href=e.toURL(),n.download=i,document.body.appendChild(n),n.click(),document.body.removeChild(n)},t.onerror=function(e){console.log("writing failed")}})},function(e){console.log("error : "+e.code)})})},function(e){console.log("error : "+e)})}}}]),angular.module("ngManager").factory("$errorService",["$mdToast",function(e){var t=function(t){var n="";n="string"==typeof t?t:t.message?t.message:t?t.toString():"Unknown Error",e.show({controller:["$scope",function(r){r.message=n,r.params=t.params||{},r.closeToast=function(){e.hide()}}],templateUrl:"toasts/error.html",hideDelay:3e4,position:"top right"})};return{showError:t}}]),angular.module("ngManager").config(["$translateLoaderProvider",function(e){e.translations("en",{name:"Name",url:"URL"})}]),angular.module("ngManager").config(["$translateLoaderProvider",function(e){e.translations("ja",{Add:"追加",Cancel:"キャンセル",Close:"閉じる",Create:"作成",Endpoints:"エンドポイント",Entities:"データ",Name:"名前",Update:"更新",Modify:"編集",Remove:"削除",Search:"検索",Settings:"設定",Submit:"送信",Top:"トップ",name:"名前",url:"URL","Add the endpoint":"エンドポイント追加","Entity configuration not found for {{kind}}":"{{kind}}のデータ設定が見つかりません"})}]),angular.module("ngManager").provider("$translateLoader",function(){var e={},t=function(t,n){var r=e[n];r||(r=e[n]={}),e[n]=_.merge(t,r)};this.translations=function(e,n){t(n,e)},this.$get=["$q",function(n){var r=function(t){var r=t.key,i=n.defer();return i.resolve(e[r]||{}),i.promise};return r.addTables=function(e){_.each(e,t)},r}]}).config(["$translateProvider",function(e){e.useLoader("$translateLoader"),e.determinePreferredLanguage()}]),angular.module("ngManager").controller("IndexCtrl",["$scope","$rootScope","$mdSidenav","$timeout","$interval","$location","$window","$translate","$translateLoader","$endpointService","$authService",function(e,t,n,r,i,o,a,l,c,u,s){e.toggleMenu=function(){r(function(){n("left-menu").toggle()})},e.site={title:"NG-Manager"},e.head={title:""},t.$on("content.title",function(t,n){e.head.title=n}),t.$on("$locationChangeSuccess",function(){e.hash=location.hash,n("left-menu").close()}),t.$on("progress.start",function(){e.progress={mode:"query",value:0}}),t.$on("progress.end",function(){var t=e.progress;if("query"===t.mode)r(function(){e.progress=!1},500);else if("determinate"===t.mode)var n=i(function(){t.value+=20,t.value>=100&&(i.cancel(n),r(function(){delete e.progress},400))},50)}),e.openRight=!0,t.$on("config",function(t,n){console.info("Loaded configuration",n),e.config=n,e.site=n.site,n.i18n&&(c.addTables(n.i18n),l.refresh())}),a.addEventListener("resize",function(){t.$broadcast("window.resize")}),e.logout=function(){s.logout(),o.url("/login")}}]),angular.module("ngManager").controller("LoginCtrl",["$scope","$rootScope","$endpointService",function(e,t,n){t.$emit("content.title",{section:"Login"}),e.getUrl=function(e){var t=n.getSelected(),r=t.url.replace(/(.*)\/+$/,"$1");return e=e.replace(/^\/+(.*)$/,"$1"),r+"/"+e}}]),angular.module("ngManager").factory("$schemaForm",["$errorService","$mdDialog","$rootScope","$sideContent","$schemaNormalizer","$schemaValidator","$q",function(e,t,n,r,i,o,a){var l=function(e){return function(t){var n=o.validate(e.entity,e.schema);n?(n.forEach(function(t){e.errors[t.path]=t.message}),e.hasError=!0):(t?delete e.errors[t]:e.errors={},e.hasError=!1)}},c=function(t,n,r,i){return function(){t.validate(),t.hasError||(r||(n.hide(),i.reject()),r(t).then(function(){n.hide(),i.resolve(t.entity)},function(t){i.reject(t),e.showError(t)}))}},u=function(e,t,n){return function(){t.hide(),n.reject()}};return{showDialog:function(e){e=e||{};var n=e.schema,r=e.entity||{},o=e.event,s=a.defer(),d=e.submit,f=e.theme||"dialog";return n=i(n),t.show({template:'<md-dialog md-theme="'+f+'"><schema-form /></md-dialog>',targetEvent:o,controller:["$scope",function(i){i.schema=n,i.entity=r,i.title=e.title||"",i.errors={},i.validate=l(i),i.submit=c(i,t,d,s),i.cancel=u(i,t,s)}]}),s.promise},showSide:function(e){var t=e.schema,o=e.entity||{},s=a.defer(),d=e.submit;t=i(t);var f=n.$new();f.schema=t,f.entity=o,f.errors={},f.validate=l(f);var m=r(f);return f.submit=c(f,m,d,s),f.cancel=u(f,m,s),m.show(),s.promise}}}]).directive("schemaForm",function(){return{restrict:"AE",templateUrl:"schema-form/form.html"}}).directive("schemaItem",["$compile","$templateCache",function(e,t){var n=function(n,r){var i=n.schema,o="";switch(i.type){case"string":o=i["enum"]?t.get("schema-form/input_radio.html"):i.multiline?t.get("schema-form/input_textarea.html"):"anchor"==i.format?t.get("schema-form/anchor.html"):t.get("schema-form/input.html");break;case"boolean":o=t.get("schema-form/input_boolean.html");break;case"number":o=t.get("schema-form/input_number.html");break;case"object":n.entity[n.schema.path]=n.entity[n.schema.path]||{},o="file"==i.format?t.get("schema-form/input_file.html"):t.get("schema-form/input_object.html");break;case"array":i.items&&i.items["enum"]?(n.entity&&(n.entity[n.schema.path]=n.entity[n.schema.path]||[]),o=t.get("schema-form/input_checkboxes.html")):"tag"==i.format?(n.entity&&(n.entity[n.schema.path]=n.entity[n.schema.path]||[]),o=t.get("schema-form/input_tag.html")):(n.entity[n.schema.path]=n.entity[n.schema.path]||[],o=t.get("schema-form/input_array.html"))}var a=e(angular.element(o))(n);i.style&&a.addClass(i.style),r.append(a)};return{scope:{schema:"=",entity:"=",errors:"="},restrict:"AE",replace:!0,link:n}}]),angular.module("ngManager").factory("$schemaNormalizer",function(){var e=function(t,n,r){return t.$$normalized?t:("string"==typeof t&&(t={type:t}),n?t.path=n+"."+r:t.path=r,t.key=r,"object"===t.type&&(_.each(t.properties,function(r,i){t.properties[i]=e(r,n,i)}),t.keyOrder=_.keys(t.properties)),"array"===t.type&&(_.each(t.items,function(r,i){t.items[i]=e(r,n,i)}),t.keyOrder=_.keys(t.items)),t.$$normalized=!0,t)};return e}),angular.module("ngManager").factory("$schemaValidator",function(){var e={"date-time":/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{1,3})?(?:Z|[+\-]\d{2}:\d{2})$/,date:/^\d{4}-\d{2}-\d{2}$/,time:/^\d{2}:\d{2}:\d{2}(?:\.\d{1,3})?$/,"utc-millisec":function(e){return!isNaN(parseInt(e,10))},regex:function(e){try{new RegExp(e)}catch(t){return!1}return!0},color:/^(?:(?:#?[0-9a-fA-F]{3,6})|(?:rgb\(\s*\b(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(?:rgb\(\s*(?:\d?\d%|100%)\s*,\s*(?:\d?\d%|100%)\s*,\s*(?:\d?\d%|100%)\s*\))|(?:maroon|red|orange|yellow|olive|green|purple|fuchsia|lime|teal|aqua|blue|navy|black|gray|silver|white|indianred|lightcoral|salmon|darksalmon|lightsalmon|crimson|firebrick|darkred|pink|lightpink|hotpink|deeppink|mediumvioletred|palevioletred|lightsalmon|coral|tomato|orangered|darkorange|gold|lightyellow|lemonchiffon|lightgoldenrodyellow|papayawhip|moccasin|peachpuff|palegoldenrod|khaki|darkkhaki|lavender|thistle|plum|violet|orchid|magenta|mediumorchid|mediumpurple|amethyst|blueviolet|darkviolet|darkorchid|darkmagenta|indigo|slateblue|darkslateblue|mediumslateblue|greenyellow|chartreuse|lawngreen|limegreen|palegreen|lightgreen|mediumspringgreen|springgreen|mediumseagreen|seagreen|forestgreen|darkgreen|yellowgreen|olivedrab|darkolivegreen|mediumaquamarine|darkseagreen|lightseagreen|darkcyan|cyan|lightcyan|paleturquoise|aquamarine|turquoise|mediumturquoise|darkturquoise|cadetblue|steelblue|lightsteelblue|powderblue|lightblue|skyblue|lightskyblue|deepskyblue|dodgerblue|cornflowerblue|mediumslateblue|royalblue|mediumblue|darkblue|midnightblue|cornsilk|blanchedalmond|bisque|navajowhite|wheat|burlywood|tan|rosybrown|sandybrown|goldenrod|darkgoldenrod|peru|chocolate|saddlebrown|sienna|brown|snow|honeydew|mintcream|azure|aliceblue|ghostwhite|whitesmoke|seashell|beige|oldlace|floralwhite|ivory|antiquewhite|linen|lavenderblush|mistyrose|gainsboro|lightgrey|darkgray|dimgray|lightslategray|slategray|darkslategray))$/i,style:/^\s*[^:]+\s*:\s*[^:;]+\s*;{0,1}\s*$/,uri:/^(?:(?:[a-z0-9+.\-]+:\/\/)(?:(?:(?:[a-z0-9-._~!$&'()*+,;=:]|%[0-9A-F]{2})*)@)?(?:(?:[a-z0-9-._~!$&'()*+,;=]|%[0-9A-F]{2})*)(?::(?:\d*))?(?:\/(?:[a-z0-9-._~!$&'()*+,;=:@\/]|%[0-9A-F]{2})*)?|(?:[a-z0-9+.\-]+:)(?:\/?(?:[a-z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})+(?:[a-z0-9-._~!$&'()*+,;=:@\/]|%[0-9A-F]{2})*)?)(?:\?(?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*)?(?:#(?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*)?$/i,email:/^(?!(?:(?:\x22?\x5C[\x00-\x7E]\x22?)|(?:\x22?[^\x5C\x22]\x22?)){255,})(?!(?:(?:\x22?\x5C[\x00-\x7E]\x22?)|(?:\x22?[^\x5C\x22]\x22?)){65,}@)(?:(?:[\x21\x23-\x27\x2A\x2B\x2D\x2F-\x39\x3D\x3F\x5E-\x7E]+)|(?:\x22(?:[\x01-\x08\x0B\x0C\x0E-\x1F\x21\x23-\x5B\x5D-\x7F]|(?:\x5C[\x00-\x7F]))*\x22))(?:\.(?:(?:[\x21\x23-\x27\x2A\x2B\x2D\x2F-\x39\x3D\x3F\x5E-\x7E]+)|(?:\x22(?:[\x01-\x08\x0B\x0C\x0E-\x1F\x21\x23-\x5B\x5D-\x7F]|(?:\x5C[\x00-\x7F]))*\x22)))*@(?:(?:(?!.*[^.]{64,})(?:(?:(?:xn--)?[a-z0-9]+(?:-[a-z0-9]+)*\.){1,126}){1,}(?:(?:[a-z][a-z0-9]*)|(?:(?:xn--)[a-z0-9]+))(?:-[a-z0-9]+)*)|(?:\[(?:(?:IPv6:(?:(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){7})|(?:(?!(?:.*[a-f0-9][:\]]){7,})(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,5})?::(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,5})?)))|(?:(?:IPv6:(?:(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){5}:)|(?:(?!(?:.*[a-f0-9]:){5,})(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,3})?::(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,3}:)?)))?(?:(?:25[0-5])|(?:2[0-4][0-9])|(?:1[0-9]{2})|(?:[1-9]?[0-9]))(?:\.(?:(?:25[0-5])|(?:2[0-4][0-9])|(?:1[0-9]{2})|(?:[1-9]?[0-9]))){3}))\]))$/i,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,"host-name":/^(?:(?:[a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$/};_.each(e,function(e,t){"function"==typeof e?tv4.addFormat(t,function(n){return null===n||void 0===n||0===n.length?null:e(n)?null:"must be valid format: "+t}):tv4.addFormat(t,function(n){return null===n||void 0===n||0===n.length?null:e.test(n)?null:"must be valid "+t})});var t=function(e){"object"==typeof e&&_.each(e,function(n,r){""===n||void 0===n||null===n?delete e[r]:"object"==typeof n&&t(e[r])})};return{validate:function(e,n,r){t(e);var i=tv4.validateMultiple(e,n);if(i.valid)return null;if(_.each(i.errors,function(e){var t="/";e.dataPath&&(t=e.dataPath),e.params.key&&(t=e.dataPath+"/"+e.params.key),t=t.split("/"),t.shift(),e.path=t.join(".")}),r){for(var o=0;o<i.errors.length;o++){var a=i.errors[o];if(a.path===r)return[a]}return null}return i.errors}}}),angular.module("ngManager").service("$sideContent",["$rootElement","$mdSidenav","$mdTheming","$animate","$timeout","$window","$compile",function(e,t,n,r,i,o,a){var l=null,c=null;return function(n){l&&(l.$destroy(),c.remove(),l=null);var r=a('<md-sidenav class="md-sidenav-right md-whiteframe-z2 side-form" md-theme="side" md-component-id="right-form"><md-content layout="column"><schema-form /></md-content></md-sidenav>')(n),i=function(){e.find("body").append(r),t("right-form").toggle(),l=n,c=r},o=function(){t("right-form").close()};return{show:i,hide:o}}}]),angular.module("ngManager").controller("TagCtrl",["$scope","$http","$apiService","sharedScopes",function(e,t,n,r){r.setScope("TagCtrl",e),e.loadTags=function(t){return n.get(e.schema.tagUri,{query:t}).then(function(e){return e.filter(function(e){return-1!=e.text.toLowerCase().indexOf(t.toLowerCase())})})}}]),angular.module("ngManager").controller("TopCtrl",["$rootScope",function(e){e.$emit("content.title",{section:"Top"})}]),angular.module("naif.base64",[]).directive("baseSixtyFourInput",["$window",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,r,i){var o=function(t){for(var n="",r=new Uint8Array(t),i=r.byteLength,o=0;i>o;o++)n+=String.fromCharCode(r[o]);return e.btoa(n)},a={};t.readerOnload=function(e){a.base64=o(e.target.result),t.$apply(function(){i.$setViewValue(angular.copy(a))})};var l=new FileReader;l.onload=t.readerOnload,n.on("change",function(){var e=n[0].files[0];e?(a.filetype=e.type,a.filename=e.name,a.filesize=e.size,l.readAsArrayBuffer(e)):(a.filetype="",a.filename="",a.filesize="",a.base64="",i.$setViewValue(angular.copy(a)))})}}}]),function(){var e;e=angular.module("datePicker",["ngMaterial","ui.utils"]),e.directive("mdDatePicker",["$datepicker",function(e){return{template:'<div class="md-toolbar-tools dark"> <md-input-container ng-disabled="isDisabled">     <label>{{label}}</label>    <input data-date-format="yyyy-MM-dd" id="date-picker" model-view-value="true"             ng-model="value" bs-datepicker></md-input></md-input-container></div>',restrict:"E",scope:{lineColor:"@",textColor:"@",mask:"@"},link:function(e,t,n){var r;r=$("#date-picker"),e.textColor&&r.css("color",e.textColor,"important"),e.lineColor&&r.css("border-color",e.lineColor,"important")}}}])}.call(this),angular.module("ngManager").factory("sharedScopes",["$rootScope",function(e){var t={};return{setScope:function(e,n){t[e]=n},getScope:function(e){return t[e]}}}]);
//# sourceMappingURL=maps/main.js.map